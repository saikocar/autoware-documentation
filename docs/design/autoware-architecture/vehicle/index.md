# 車両インターフェース設計

## 概要

車両インターフェースコンポーネントは、Autowareと車両の間のインターフェースを提供し、車両のドライブバイワイヤシステムに制御信号を渡し、Autowareに返される車両情報を受信します。

## 1. 要件

目標:

- 車両インターフェースコンポーネントは、Autoware コマンドを車両固有の形式に変換し、車両のステータスを車両固有の形式で Autoware メッセージに変換します。
- Autowareと車両コンポーネントの間のインターフェイスは抽象化されており、ハードウェアから独立しています。
- このインターフェイスは拡張可能であるため、車両固有のコマンドを簡単に追加できます。例えばヘッドライトの制御。

非目標:

- 車両からの応答の精度は定義されませんが、参考設計からの精度要件の例が参考として提供されます。
- 応答速度は定義されません。

## 2. アーキテクチャ

車両インターフェースコンポーネントは次のコンポーネントで構成されます:

- 速度/加速制御がドライブバイワイヤシステムによってサポートされている場合、制御コンポーネントからの車両コマンドを通過する生の車両コマンド・コンバーター・コンポーネント。それ以外の場合、制御コマンドは制御方法に従って変更されます (例: 加速マップを使用して、制御コンポーネントからの目標加速度を車両固有のアクセル/ブレーキ ペダル値に変換する)
- Autowareと車両の間のインターフェースとして機能し、制御信号を通信し、車両に関する情報(ステアリング出力、タイヤ角度など)を取得する車両インターフェースコンポーネント(車両固有)

各コンポーネントにはAutowareの静的ノードが含まれていますが、各モジュールは動的にロードおよびアンロードできます(C++クラスに対応)。車両インターフェースコンポーネントのメカニズムは、次の図で示されています:

![車両インターフェースの概要](./image/vehicle_interface_architecture.png)

![車両インターフェースの概要](./image/vehicle_interface_overview.png)

## 3. 機能

車両インターフェースコンポーネントは、次の機能と機能を提供できます:

- 基本機能

  - Autoware制御コマンドを車両固有のコマンドに変換する
  - 車両固有のステータス情報(速度、ステアリング)をAutowareステータスメッセージに変換する

- 診断
  - 利用可能な機能をリストする
  - コントロールコンポーネントが車両インターフェースコンポーネントで利用できない機能を使用しようとした場合に警告を提供します

車両のハードウェアに応じて、追加の機能や機能が追加される場合があります。いくつかの機能の例を以下に示します:

- 安全機能
  - 手動介入により自動運転を解除します。
    - これは、緊急解除ボタンを使用するか、安全ドライバーが手動でステアリングホイールを回すかブレーキを押すことによって行うことができます。
- オプションのコントロール
  - 方向指示器
  - ハンドブレーキ
  - ヘッドライト
  - ハザードライト
  - ドア
  - 警笛
  - ワイパー

## 4. インターフェースとデータ構造

同じプロセス空間内で実行されている他のコンポーネントが車両インターフェース コンポーネントの機能と能力にアクセスするための車両インターフェース コンポーネントのインターフェースは、次のように定義されます。

制御から

- 作動コマンド
  - 目標の加速、制動、ステアリング角度

計画から

- 車両固有のコマンド (オプションで、タイプごとに個別のメッセージ)
  - シフト
  - ドア
  - ワイパー
  - 等

車両から

- 車両ステータスメッセージ
  - Autoware 固有の形式のメッセージに変換するための車両固有の形式のメッセージ
    - 速度ステータス
    - ステアリングステータス (オプション)
    - シフトステータス（オプション）
    - 方向指示器ステータス (オプション)
    - 作動状態（オプション）

車両インターフェースコンポーネントの出力インターフェイス:

- 車両への車両制御メッセージ
  - 車両を駆動するための制御信号
  - 車両のタイプ/プロトコルによって異なりますが、少なくともステアリングと速度のコマンドを含める必要があります
- Autowareへの車両ステータスメッセージ
- 作動ステータス
  - アクセル、ブレーキ、ステアリングの状態
- 車両オドメトリ (位置推定への出力)
  - 車両ツイスト情報
- 制御モード
  - 車両が自律制御されているか手動制御されているかに関する情報
- シフトステータス（オプション）
  - 車両のシフト状態
- 方向指示器ステータス (オプション)
  - 車両の方向指示器の状態

車両インターフェースコンポーネントで使用されるオブジェクトと軌道のセマンティクスの内部表現のデータ構造は、次のように定義されます:

## 5. 懸念事項、仮定、制限事項

懸念事項

- アーキテクチャのトレードオフとスケーラビリティ

仮定

-

制限事項

## 6. ODDによる精度要求の例
