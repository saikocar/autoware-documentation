# フェイルセーフ

## 関連するAPI

- {{ link_ad_api('/api/fail_safe/mrm_state') }}

## 説明

車両の異常に関する挙動を管理するAPIです。
これは、介入要求(RTI)、最小リスク操作(MRM)、および最小リスク条件(MRC)の状態を提供します。
Autowareには以下に示すように、通常動作時のコマンドと異常動作時のコマンドを切り替えるゲートがあります。
安全のため、Autowareは異常を検出するとMRMに動作を切り替えます。
状況に応じて求められる動作が異なるため、MRMは通常のモジュール内の特定のモード、または独立したモジュールとしてさまざまな場所に実装されます。
フェールセーフモジュールは異常に応じてMRMの動作を選択し、ゲート出力をそのコマンドに切り替えます。

![フェイルセーフアーキテクチャ](./fail-safe/architecture.drawio.svg)

## 状態

MRM状態は、MRMが動作しているかどうかを示します。この状態は成功または失敗も示します。
通常、MRM は失敗すると別の動作に切り替わります。

![mrm状態](./fail-safe/mrm-state.drawio.svg)

| 状態     | 説明                                                |
| --------- | ---------------------------------------------------------- |
| NONE      | MRMは動作していません。                                      |
| OPERATING | 異常を検知したためMRMが動作しています。 |
| SUCCEEDED | MRMは成功しました。車両は安全な状態にあります。         |
| FAILED    | MRMは失敗しました。車両は依然として危険な状態にあります。   |

## 動作

MRMの動作間には依存関係があります。たとえば、快適な停止から緊急停止に切り替わりますが、その逆は切り替わりません
これはサービスに依存します。Autowareは、デフォルトで次のトランジションをサポートします。

![mrmの動作](./fail-safe/mrm-behavior.drawio.svg)

| 状態            | 説明                                                               |
| ---------------- | ------------------------------------------------------------------------- |
| NONE             | MRMが動作していないか、動作しているが特別な動作は必要ありません。 |
| COMFORTABLE_STOP | 心地よい減速でクルマはすぐに止まります。            |
| EMERGENCY_STOP   | 車両は可能な限り減速して直ちに停止します。  |
