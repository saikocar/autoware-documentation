# 計画要素

## 関連するAPI

- {{ link_ad_api('/api/planning/velocity_factors') }}
- {{ link_ad_api('/api/planning/steering_factors') }}

## 説明

このAPIは、車両の計画された動作を管理します。
アプリケーションは車両の挙動を周囲の人に通知し、オペレーターや乗客に視覚化することができます。

## 速度要素

速度要素は、車両が停止または減速する動作に関する一連の情報です。
各要素には、以下で説明する動作タイプがあります。
一部の動作タイプには、追加情報としてシーケンスと詳細が含まれます。

| 動作                    | 説明                                                                         |
| --------------------------- | ----------------------------------------------------------------------------------- |
| 周囲の障害物        | 車両のすぐ周囲に障害物があります。                                |
| ルート障害物              | この先のルートには障害物があります。                                          |
| 交差点                | 進路上の他の車線に障害物があります。                                     |
| 横断歩道                   | 横断歩道に障害物があります。                                               |
| 後方確認                  | 背後には人間のドライバーの死角となる障害物があります。            |
| ユーザー定義の注目領域 | 事前に定義された注意エリアに障害物があります。                               |
| 一時停止禁止区域            | 停車禁止エリアを超えると十分なスペースがありません。                              |
| 一時停止標識                   | 一時停止の標識で一時停止。                                                              |
| 交通信号              | 信号で一時停止。                                                         |
| v2xゲートエリア               | ゲートエリアに立ち寄ります。シーケンスとしてEnterとLeaveがあり、詳細としてv2xタイプがあります。 |
| 合流                       | 車線合流前の一時停止。                                                        |
| 歩道                    | 歩道を渡る前の一時停止。                                                |
| 車線変更                 | 車線変更です。                                                                      |
| 回避                   | 現在の車線の障害物を回避するための経路変更。                             |
| 緊急指令         | オペレーターからの緊急指示による停止。                                  |

各要素は、ステータス、ベースリンクフレーム内のポーズ、およびそのポーズからの距離も提供します。
車両が停止位置に近づくと、この要素はAPPROACHINGというステータスで表示されます。
そして、車両がその位置に到達して停止すると、ステータスはSTOPPEDになります。
ポーズは停止位置を示しますが、また停止位置が計算できない場合はベースリンクを示します。

![速度要素](./planning-factors/velocity-factors.drawio.svg)

## ステアリング要素

ステアリング要素は、左折または右折など、方向指示器の使用を必要とする操縦に関する一連の情報です。
各要素には、以下に説明する動作タイプとステアリング方向があります。
一部の動作タイプには、追加情報としてシーケンスと詳細が含まれます。

| 動作            | 説明                                                                 |
| ------------------- | --------------------------------------------------------------------------- |
| 交差点        | 交差点での左折または右折。                                |
| 車線変更         | 車線変更です。                                                              |
| 回避           | 障害物を避けるための経路変更。変化と復帰のシーケンスがあります。 |
| スタートプランナー       | 未定                                                                      |
| ゴールプランナー        | 未定                                                                      |
| 緊急指令 | オペレーターの緊急指示による経路変更。                   |

各要素は、ステータス、ベースリンクフレーム内のポーズ、およびそのポーズからの距離も提供します。
車両がステアリングを開始する位置に近づくと、この要素はAPPROACHINGというステータスで表示されます。
車両がその位置に到達すると、ステータスは TURNING になります。
ポーズは、ステータスがTURNINGであるセクションの開始位置と終了位置を示します。

![ステアリングファクター-1](./planning-factors/steering-factors-1.drawio.svg)

車線変更や回避など、状況に応じて範囲内の任意の位置からステアリングを開始します。
これらのタイプの場合、ステータスがTURNINGであるセクションが動的に更新され、ポーズはそれに追従します。

![ステアリングファクター-2](./planning-factors/steering-factors-2.drawio.svg)
